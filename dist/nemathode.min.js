!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Nemathode=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(t){for(var r=1;arguments.length>r;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r,o,a={mathConstants:{E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG10E:Math.LOG10E,LOG2E:Math.LOG2E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2},functions:{abs:{implementation:Math.abs},min:{implementation:Math.min},areEqual:{implementation:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return t.every((function(e){return e===t[0]}))}}},toInputType:function(e){return e},toOutputValue:function(e){return e},binaryOperators:{"+":{precedence:1,implementation:function(e,t){return e+t}},"-":{precedence:1,implementation:function(e,t){return e-t}},"*":{precedence:2,implementation:function(e,t){return e*t}},"/":{precedence:2,implementation:function(e,t){return e/t}},"%":{precedence:2,implementation:function(e,t){return e%t}}}};function i(e,t){return new SyntaxError("It's just unexpected operator "+e+" at position "+t+". '\n\t\t+ 'Remove it from there")}function s(e,t){return new SyntaxError("You are using unknown operand <"+e+"> at position '\n\t\t+ '"+t+".'\n\t\t+ '\n1. most likely you missed the operator between expressions'\n\t\t+ '\n2. or you forgot to define your implementation for this operator")}function u(e,t){return new SyntaxError("You are using unknown operand <"+e+"> at position "+t+".'\n\t\t+ '\n1. most likely you missed to write a number or expression'\n\t\t+ '\n2. or you forgot to cast string to number")}!function(e){e.Number="NUMBER",e.Function="FUNCTION",e.Expression="EXPRESSION",e.MathConstantName="MATH_CONSTANT",e.BinaryOperator="BINARY_OPERATOR"}(r||(r={})),function(e){e[e.LeftOperandProcessing=1]="LeftOperandProcessing",e[e.OperatorProcessing=2]="OperatorProcessing",e[e.ReadyToCalcXValue=3]="ReadyToCalcXValue",e[e.AllOperandsAreProcessed=4]="AllOperandsAreProcessed"}(o||(o={}));var c={operandsProcessedAlready:0,evaluationStage:o.LeftOperandProcessing,memoizedLValue:void 0,memoizedRValue:void 0,memoizedBinaryOperator:void 0};function l(e,t){return t.operandsProcessedAlready>=e.length}function p(e){e.operandsProcessedAlready+=1}var d=function(e,n){return m(t({},c),e,n)},m=function e(t,n,a){for(;!1===l(n,t);){var c=n[t.operandsProcessedAlready];switch(t.evaluationStage){case o.LeftOperandProcessing:switch(c.type){case r.MathConstantName:case r.Number:t.evaluationStage=o.OperatorProcessing,t.memoizedLValue=a.toInputType(c.value),p(t);break;case r.Function:var m=c.value,f=a.functions[m.name].implementation.apply(void 0,m.args);t.evaluationStage=o.OperatorProcessing,t.memoizedLValue=a.toInputType(f),p(t);break;case r.Expression:t.evaluationStage=o.OperatorProcessing,t.memoizedLValue=a.toInputType(d(c.value,a)),p(t);break;case r.BinaryOperator:throw i(c.value,t.operandsProcessedAlready)}break;case o.OperatorProcessing:switch(c.type){case r.BinaryOperator:t.evaluationStage=o.ReadyToCalcXValue,t.memoizedBinaryOperator=c.value,p(t);break;case r.Expression:case r.MathConstantName:case r.Number:throw s(c.value,t.operandsProcessedAlready)}break;case o.ReadyToCalcXValue:switch(c.type){case r.MathConstantName:case r.Number:t.evaluationStage=o.AllOperandsAreProcessed,t.memoizedRValue=a.toInputType(c.value),p(t);break;case r.Function:var y=c.value,h=a.functions[y.name].implementation.apply(void 0,y.args);t.evaluationStage=o.AllOperandsAreProcessed,t.memoizedRValue=a.toInputType(h),p(t);break;case r.Expression:t.evaluationStage=o.AllOperandsAreProcessed,t.memoizedRValue=a.toInputType(d(c.value,a)),p(t);break;case r.BinaryOperator:throw u(c.value,t.operandsProcessedAlready)}break;case o.AllOperandsAreProcessed:switch(c.type){case r.BinaryOperator:var g=c.value,v=t.memoizedBinaryOperator;if(a.binaryOperators[v].precedence<a.binaryOperators[g].precedence){var O={evaluationStage:o.ReadyToCalcXValue,operandsProcessedAlready:t.operandsProcessedAlready+1,memoizedLValue:t.memoizedRValue,memoizedBinaryOperator:g,memoizedRValue:void 0};t.evaluationStage=o.AllOperandsAreProcessed,t.memoizedRValue=a.toInputType(e(O,n,a)),t.operandsProcessedAlready=O.operandsProcessedAlready}else t.evaluationStage=o.ReadyToCalcXValue,t.memoizedLValue=a.binaryOperators[v].implementation(t.memoizedLValue,t.memoizedRValue),t.memoizedBinaryOperator=g,t.memoizedRValue=void 0,p(t)}}}return a.toOutputValue(t.memoizedBinaryOperator?a.binaryOperators[t.memoizedBinaryOperator].implementation(t.memoizedLValue,t.memoizedRValue):t.memoizedLValue)};function f(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var n,r,o=[];for(n=0;t.length>=n;n++)o[n]=[n];for(r=0;e.length>=r;r++)o[0][r]=r;for(n=1;t.length>=n;n++)for(r=1;e.length>=r;r++)o[n][r]=t.charAt(n-1)===e.charAt(r-1)?o[n-1][r-1]:Math.min(o[n-1][r-1]+1,Math.min(o[n][r-1]+1,o[n-1][r]+1));return o[t.length][e.length]}function y(e,t){return e.distance-t.distance}function h(e,t){for(var n=t.map((function(t){return function(e,t){for(var n=[],r=0;t.length>r;++r){var o=t[r],a=f(e,o);n.push({source:e,suggestion:o,distance:a})}return function(e){return e.filter((function(e){return e.source.length>e.distance||e.suggestion.includes(e.source)}))}(n)}(e,t)})).filter((function(e){return e.length>0})),r=[],o=0;n.length>o;++o)for(var a=0;n[o].length>a;++a)r.push(n[o][a]);return r.sort(y)}function g(e,t){return new SyntaxError(function(e,t){var n=h(e,t),r="Cannot find operand --\x3e "+e+".\n",o="Most likely you made a mistake when you were writing the operand or you forgot to cast string to number.\n";if(0===n.length)return r+o+"There are nothing even remotely close to your input in config you passed :(";return r+o+"Maybe you want to use on of the following?\n"+n.reduce((function(e,t){return e+"\t"+t.suggestion+"\n"}),"")}(e,[Object.keys(t.functions),Object.keys(t.mathConstants),Object.keys(t.binaryOperators)]))}function v(e,t){if(!Array.isArray(e))throw new SyntaxError("It looks like you passed expression with wrong format:\n1. Check your expression, please\n2. Check TS configuration");if(0===e.length)throw new SyntaxError("It looks like you passed an empty expression\n1. Please check your expression");for(var n=[],o=0;e.length>o;++o)if("number"!=typeof e[o]){var a="string"==typeof e[o];if(a&&t.binaryOperators[e[o]])n.push({type:r.BinaryOperator,value:e[o]});else if(a&&t.mathConstants[e[o]])n.push({type:r.MathConstantName,value:t.mathConstants[e[o]]});else if(Array.isArray(e[o])&&"string"==typeof e[o][0]&&t.functions[e[o][0]]){var i=[].concat(e[o]),s=i.shift(),u=[].concat(i);n.push({type:r.Function,value:{name:s,args:u}})}else{var c=n.length;if(!(c>0&&n[c-1].type===r.Function)){if(!Array.isArray(e[o]))throw g(e[o],t);var l={type:r.Expression,value:v(e[o],t)};n.push(l)}}}else{n.push({type:r.Number,value:e[o]})}return n}var O=function(e){var n=this;this.evaluate=function(e){var r=v(e,t({},n.config));return d([].concat(r),t({},n.config))},this.evaluatePlease=function(e){return console.info("ðŸ¤—"),n.evaluate(e)},this.evaluateAst=function(e){return d([].concat(e),t({},n.config))},this.getAst=function(e){return v(e,t({},n.config))},this.config=e,this.mathConstants=e.mathConstants};return function(e){return new O({mathConstants:(null==e?void 0:e.mathConstants)||a.mathConstants,functions:(null==e?void 0:e.functions)||a.functions,binaryOperators:(null==e?void 0:e.binaryOperators)||a.binaryOperators,toInputType:(null==e?void 0:e.toInputType)||a.toInputType,toOutputValue:(null==e?void 0:e.toOutputValue)||a.toOutputValue})}}));
